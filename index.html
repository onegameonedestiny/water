<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æ²³ç¥è©¦ç…‰ï½œéŠæˆ²å…¥å£</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <!-- Construct 3 ç”¨ -->
  <meta name="generator" content="Scirra Construct">
  <link rel="manifest" href="appmanifest.json">
  <link rel="stylesheet" href="style.css">

  <!-- åŠ å…¥ LINE LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <script>
  // =============================
  // âœ… å…¨åŸŸè®Šæ•¸è¨­å®š
  // =============================
  window.liffReady = false;
  window.liffProfile = null;

  // âœ… å–å¾—ç¶²å€åƒæ•¸
  function getQueryParam(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
  }

  // =============================
  // âœ… åˆå§‹åŒ– LIFF
  // =============================
  async function initLiff() {
    const liffId = getQueryParam("liff_id");
    if (!liffId) {
      console.warn("âš ï¸ æ²’æœ‰ liff_id åƒæ•¸ï¼Œè·³é LIFF åˆå§‹åŒ–");
      startConstruct(); // å³ä½¿æ²’æœ‰ LIFF ä¹Ÿå•Ÿå‹•éŠæˆ²
      return;
    }

    try {
      console.log("ğŸ”„ æ­£åœ¨åˆå§‹åŒ– LIFF... ID:", liffId);
      await liff.init({ liffId });

      window.liffReady = true;
      window.liffProfile = await liff.getProfile();
      console.log("âœ… LIFF åˆå§‹åŒ–æˆåŠŸï¼Œä½¿ç”¨è€…ï¼š", window.liffProfile.displayName);
    } catch (err) {
      console.error("âŒ LIFF åˆå§‹åŒ–å¤±æ•—ï¼š", err);
      alert("LIFF åˆå§‹åŒ–å¤±æ•—ï¼Œå°‡ä»¥ä¸€èˆ¬æ¨¡å¼é–‹å•Ÿã€‚\n" + err.message);
    }

    // ç„¡è«–æˆåŠŸèˆ‡å¦ï¼Œéƒ½å•Ÿå‹• Construct 3 éŠæˆ²
    startConstruct();
  }

  // =============================
  // âœ… Construct 3 å•Ÿå‹•
  // =============================
  function startConstruct() {
    const s = document.createElement("script");
    s.type = "module";
    s.src = "scripts/main.js";
    document.body.appendChild(s);
  }

  // âœ… é é¢è¼‰å…¥å¾Œé–‹å§‹åˆå§‹åŒ–
  window.addEventListener("DOMContentLoaded", initLiff);
  </script>
</head>

<body>
  <noscript>
    <div id="notSupportedWrap">
      <h2 id="notSupportedTitle">This content requires JavaScript</h2>
      <p class="notSupportedMessage">è«‹å•Ÿç”¨ JavaScript æ‰èƒ½åŸ·è¡ŒéŠæˆ²ã€‚</p>
    </div>
  </noscript>

  <script src="scripts/modernjscheck.js"></script>
  <script src="scripts/supportcheck.js"></script>
  <script src="scripts/offlineclient.js" type="module"></script>
  <!-- ä¸è¦æ‰‹å‹•è¼‰å…¥ main.jsï¼Œæœƒç”±ä¸Šæ–¹ startConstruct() æ§åˆ¶ -->
  <!-- <script src="scripts/main.js" type="module"></script> -->
  <script src="scripts/register-sw.js" type="module"></script>
</body>
</html>
